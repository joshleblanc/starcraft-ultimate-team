<div class="mb-8 flex items-center justify-between">
  <div>
    <h1 class="text-3xl font-bold text-white">ğŸ† Cup Rush Leagues</h1>
    <p class="mt-2 text-gray-400">Compete in team leagues to prove your worth</p>
  </div>
  <% if current_user.active_team %>
    <%= link_to new_league_path, class: "rounded-md bg-cyan-600 px-4 py-2 font-semibold text-white hover:bg-cyan-500" do %>
      â• Create League
    <% end %>
  <% end %>
</div>

<% unless current_user.active_team %>
  <div class="mb-6 rounded-md bg-yellow-900/50 border border-yellow-500 p-4">
    <p class="text-sm text-yellow-400">
      âš ï¸ You need to <%= link_to "create a team", new_team_path, class: "underline hover:no-underline" %> before you can join leagues.
    </p>
  </div>
<% end %>

<!-- Active Leagues -->
<% if @active_leagues.any? %>
  <div class="mb-8">
    <h2 class="text-xl font-bold text-white mb-4">ğŸ”¥ Active Leagues</h2>
    <div class="grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3">
      <% @active_leagues.each do |league| %>
        <%= link_to league, class: "rounded-xl bg-gray-800 border border-gray-700 p-6 hover:border-cyan-500 transition-colors" do %>
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-bold text-white"><%= league.name %></h3>
            <span class="px-2 py-1 rounded text-xs font-semibold bg-green-500/20 text-green-400">Active</span>
          </div>
          <div class="text-sm text-gray-400">
            <div>Round <%= league.current_round %> of <%= league.total_rounds %></div>
            <div><%= league.teams.count %> teams</div>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
<% end %>

<!-- Pending Leagues (Joinable) -->
<% if @pending_leagues.any? %>
  <div class="mb-8">
    <h2 class="text-xl font-bold text-white mb-4">ğŸ“ Open for Registration</h2>
    <div class="grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3">
      <% @pending_leagues.each do |league| %>
        <div class="rounded-xl bg-gray-800 border border-gray-700 p-6">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-bold text-white"><%= league.name %></h3>
            <span class="px-2 py-1 rounded text-xs font-semibold bg-yellow-500/20 text-yellow-400">Pending</span>
          </div>
          <div class="text-sm text-gray-400 mb-4">
            <div><%= league.teams.count %>/<%= league.max_teams %> teams</div>
          </div>
          <% if current_user.active_team && !league.teams.include?(current_user.active_team) && !league.full? %>
            <%= button_to "Join League", join_league_path(league), class: "w-full rounded-md bg-cyan-600 px-4 py-2 font-semibold text-white hover:bg-cyan-500" %>
          <% elsif league.teams.include?(current_user.active_team) %>
            <div class="text-center text-cyan-400 text-sm">âœ“ Already joined</div>
          <% elsif league.full? %>
            <div class="text-center text-gray-500 text-sm">League is full</div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
<% end %>

<!-- My Leagues -->
<% if @my_leagues.any? %>
  <div class="mb-8">
    <h2 class="text-xl font-bold text-white mb-4">ğŸ“‹ My Leagues</h2>
    <div class="rounded-xl bg-gray-800 border border-gray-700 overflow-hidden">
      <table class="w-full">
        <thead class="bg-gray-700/50 text-sm text-gray-400">
          <tr>
            <th class="px-4 py-2 text-left">League</th>
            <th class="px-4 py-2 text-center">Status</th>
            <th class="px-4 py-2 text-center">Record</th>
            <th class="px-4 py-2 text-center">Points</th>
            <th class="px-4 py-2"></th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-700">
          <% @my_leagues.each do |league| %>
            <% membership = league.league_memberships.find_by(team: current_user.active_team) %>
            <tr class="hover:bg-gray-700/50">
              <td class="px-4 py-3">
                <div class="font-semibold text-white"><%= league.name %></div>
                <div class="text-xs text-gray-500">
                  <% if league.active? %>
                    Round <%= league.current_round %>/<%= league.total_rounds %>
                  <% end %>
                </div>
              </td>
              <td class="px-4 py-3 text-center">
                <span class="px-2 py-1 rounded text-xs font-semibold 
                  <%= league.status == 'active' ? 'bg-green-500/20 text-green-400' : 
                      league.status == 'completed' ? 'bg-gray-500/20 text-gray-400' : 
                      'bg-yellow-500/20 text-yellow-400' %>">
                  <%= league.status.capitalize %>
                </span>
              </td>
              <td class="px-4 py-3 text-center text-white">
                <%= membership&.match_wins || 0 %>-<%= membership&.match_losses || 0 %>
              </td>
              <td class="px-4 py-3 text-center">
                <span class="text-purple-400 font-semibold"><%= membership&.points || 0 %></span>
              </td>
              <td class="px-4 py-3 text-right">
                <%= link_to "View â†’", league, class: "text-cyan-400 hover:text-cyan-300 text-sm" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
<% end %>

<% if @active_leagues.empty? && @pending_leagues.empty? && @my_leagues.empty? %>
  <div class="rounded-xl bg-gray-800 border border-gray-700 p-8 text-center">
    <div class="text-4xl mb-4">ğŸ†</div>
    <h3 class="text-lg font-semibold text-white mb-2">No leagues yet</h3>
    <p class="text-gray-400 mb-4">Create a league to start competing!</p>
    <% if current_user.active_team %>
      <%= link_to "Create League", new_league_path, class: "inline-flex items-center px-4 py-2 rounded-md bg-cyan-600 text-white font-semibold hover:bg-cyan-500" %>
    <% else %>
      <%= link_to "Create Team First", new_team_path, class: "inline-flex items-center px-4 py-2 rounded-md bg-cyan-600 text-white font-semibold hover:bg-cyan-500" %>
    <% end %>
  </div>
<% end %>
